language: node_js

sudo: required

before_cache:
  - rm -f ./node_modules/.bin/which

cache:
  - directories:
      - "node_modules"
      - "vendor"
      - "_site/assets/processed-img"

script:
  - ./_scripts/run-tests.sh

branches:
  except:
  - master

node_js:
 - '6.1'

before_install:
  - rvm install 2.1
  - rvm use 2.1
  - gem install bundler
  - bundle check || bundle install

env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true

deploy:
  provider: script
  script: "./_scripts/build.sh"
  skip_cleanup: false
  on:
    branch: development
